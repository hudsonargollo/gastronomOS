name = "gastronomos"
main = "src/index.ts"
compatibility_date = "2023-12-18"
compatibility_flags = ["nodejs_compat"]

# Development environment configuration
[env.development.vars]
ENVIRONMENT = "development"
LOG_LEVEL = "debug"
CACHE_TTL = "300"
JWT_EXPIRY = "86400"
BCRYPT_ROUNDS = "10"

# Development R2 bucket binding (disabled until R2 is enabled)
# [[env.development.r2_buckets]]
# binding = "RECEIPT_BUCKET"
# bucket_name = "gastronomos-receipts-dev"

# Development AI binding
[env.development.ai]
binding = "AI"

# Staging environment configuration
[env.staging.vars]
ENVIRONMENT = "staging"
LOG_LEVEL = "info"
CACHE_TTL = "600"
JWT_EXPIRY = "43200"
BCRYPT_ROUNDS = "12"

# Staging R2 bucket binding (disabled until R2 is enabled)
# [[env.staging.r2_buckets]]
# binding = "RECEIPT_BUCKET"
# bucket_name = "gastronomos-receipts-staging"

# Staging AI binding
[env.staging.ai]
binding = "AI"

# Production environment configuration
[env.production.vars]
ENVIRONMENT = "production"
LOG_LEVEL = "warn"
CACHE_TTL = "900"
JWT_EXPIRY = "28800"
BCRYPT_ROUNDS = "14"
RATE_LIMIT_ENABLED = "true"
AUDIT_LOG_RETENTION_DAYS = "90"

# Production R2 bucket binding (disabled until R2 is enabled)
# [[env.production.r2_buckets]]
# binding = "RECEIPT_BUCKET"
# bucket_name = "gastronomos-receipts-prod"

# Production AI binding
[env.production.ai]
binding = "AI"

# Production analytics engine datasets (disabled until analytics are set up)
# [[env.production.analytics_engine_datasets]]
# binding = "QUEUE_ANALYTICS"
# dataset = "receipt_processing_metrics_prod"

# Production durable objects (disabled until durable objects are set up)
# [[env.production.durable_objects.bindings]]
# name = "QUEUE_STATE"
# class_name = "QueueStateManager"
# script_name = "gastronomos"

# D1 Database bindings for each environment
[[env.development.d1_databases]]
binding = "DB"
database_name = "gastronomos-dev"
database_id = "your-dev-database-id-here"
migrations_dir = "migrations"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "gastronomos-staging"
database_id = "your-staging-database-id-here"
migrations_dir = "migrations"

[[env.production.d1_databases]]
binding = "DB"
database_name = "gastronomos-prod"
database_id = "253e34dc-9dfe-4a3b-8c2e-773f3294b15d"
migrations_dir = "migrations"

# Default D1 Database binding (fallback for local development)
[[d1_databases]]
binding = "DB"
database_name = "gastronomos-db"
database_id = "your-database-id-here"
migrations_dir = "migrations"

# Worker limits and configuration (disabled for free plan)
# [limits]
# cpu_ms = 50

# R2 Bucket bindings for receipt storage (disabled until R2 is enabled)
# [[r2_buckets]]
# binding = "RECEIPT_BUCKET"
# bucket_name = "gastronomos-receipts"

# AI binding for OCR processing
[ai]
binding = "AI"

# Queue bindings for receipt processing (disabled until queues are set up)
# [[queues.producers]]
# queue = "receipt-processing-queue"
# binding = "RECEIPT_QUEUE"

# [[queues.consumers]]
# queue = "receipt-processing-queue"
# max_batch_size = 10
# max_batch_timeout = 30
# max_retries = 3
# dead_letter_queue = "receipt-processing-dlq"

# Dead letter queue for failed receipt processing (disabled)
# [[queues.producers]]
# queue = "receipt-processing-dlq"
# binding = "RECEIPT_DLQ"

# Analytics binding for queue monitoring (disabled until analytics are set up)
# [[analytics_engine_datasets]]
# binding = "QUEUE_ANALYTICS"
# dataset = "receipt_processing_metrics"

# Durable Objects for queue state management (disabled until durable objects are set up)
# [[durable_objects.bindings]]
# name = "QUEUE_STATE"
# class_name = "QueueStateManager"
# script_name = "gastronomos"

# Environment-specific queue configurations (disabled until queues are set up)
# [env.development.queues]
# [[env.development.queues.producers]]
# queue = "receipt-processing-queue-dev"
# binding = "RECEIPT_QUEUE"

# [[env.development.queues.consumers]]
# queue = "receipt-processing-queue-dev"
# max_batch_size = 5
# max_batch_timeout = 15
# max_retries = 2

# [env.staging.queues]
# [[env.staging.queues.producers]]
# queue = "receipt-processing-queue-staging"
# binding = "RECEIPT_QUEUE"

# [[env.staging.queues.consumers]]
# queue = "receipt-processing-queue-staging"
# max_batch_size = 10
# max_batch_timeout = 30
# max_retries = 3

# [env.production.queues]
# [[env.production.queues.producers]]
# queue = "receipt-processing-queue-prod"
# binding = "RECEIPT_QUEUE"

# [[env.production.queues.consumers]]
# queue = "receipt-processing-queue-prod"
# max_batch_size = 20
# max_batch_timeout = 60
# max_retries = 5
# dead_letter_queue = "receipt-processing-dlq-prod"